<script>
    document.querySelectorAll('.to-wishlist-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        Swal.fire({
            icon: 'warning',
            text: 'Please log in to add to wishlist',
            showConfirmButton: true,
            confirmButtonText: 'okay'
        })
    });
});


    document.querySelectorAll('.add-to-wishlist-btn').forEach(btn => {
            const icon = btn.querySelector('i');

            // On load: set heart based on data-is-wishlisted
            if (btn.dataset.isWishlisted === 'true') {
                icon.classList.remove('wishlist');
                icon.classList.add('wishlist2');
            }

            btn.addEventListener('click', async (e) => {
                e.preventDefault();

                const userId = btn.dataset.userId;
                const productId = btn.dataset.productId;
                

                const productDetails = { userId, productId};
                console.log(`heeeee`,productDetails);
                
                try {
                    const response = await fetch('/user/wishlist', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(productDetails)
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        Swal.fire({
                            icon: 'warning',
                            text: data.error,
                            showConfirmButton: false,
                            timer: 2000
                        });
                    } else {
                        // Set icon to solid heart
                        icon.classList.remove('wishlist');
                        icon.classList.add('wishlist2');
                        btn.dataset.isWishlisted = 'true';

                        Swal.fire({
                            icon: 'success',
                            text: 'Added to wishlist successfully',
                            showConfirmButton: true,
                            confirmButtonText: 'Go to wishlist',
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.location.href = '/user/wishlist';
                            }
                        });
                    }
                } catch (error) {
                    Swal.fire({
                        icon: 'error',
                        text: 'An error occurred',
                        showConfirmButton: false,
                        timer: 2000
                    });
                }
            });
        });

   </script>